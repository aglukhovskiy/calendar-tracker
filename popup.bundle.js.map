{"version":3,"file":"popup.bundle.js","mappings":"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","sources":["webpack://stopwatch-widget-extension/./popup.js"],"sourcesContent":["document.addEventListener('DOMContentLoaded', function() {\n    const timerDisplay = document.getElementById('timer-display');\n    const startBtn = document.getElementById('start-btn');\n    const pauseBtn = document.getElementById('pause-btn');\n    const stopBtn = document.getElementById('stop-btn');\n    const projectSelect = document.getElementById('project-select');\n    const calendarBtn = document.getElementById('calendar-btn');\n\n    let projects = [];\n    let stopwatch = { isRunning: false, startTimestamp: null, elapsed: 0, liveEventId: null, projectId: null };\n    let interval = null;\n\n    function updateDisplay() {\n        let ms = stopwatch.elapsed;\n        if(stopwatch.isRunning && stopwatch.startTimestamp)\n            ms += Date.now() - stopwatch.startTimestamp;\n        let sec = Math.floor(ms/1000), min = Math.floor(sec/60);\n        sec = sec%60;\n        timerDisplay.textContent = `${min.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;\n        timerDisplay.style.color='#fff';\n        startBtn.disabled = stopwatch.isRunning || !projectSelect.value;\n        pauseBtn.disabled = !stopwatch.isRunning;\n        stopBtn.disabled = (!stopwatch.isRunning && stopwatch.elapsed===0);\n    }\n\n    function loadProjects() {\n        chrome.storage.local.get(['projects','selectedProjectId'], res => {\n            projects = res.projects||[];\n            projectSelect.innerHTML = `<option value=\"\">-- Проект --</option>`;\n            projects.forEach(prj=>{\n                let opt = document.createElement('option');\n                opt.value = prj.id; opt.textContent = prj.name;\n                projectSelect.appendChild(opt);\n            });\n            if(res.selectedProjectId) projectSelect.value=res.selectedProjectId;\n            updateDisplay();\n        });\n    }\n\n    function loadStopwatch() {\n        chrome.storage.local.get('stopwatch', res => {\n            if(res.stopwatch) stopwatch = {...stopwatch, ...res.stopwatch};\n            updateDisplay();\n        });\n    }\n\n    chrome.storage.onChanged.addListener((changes, area) => {\n        if(area===\"local\" && changes.stopwatch) loadStopwatch();\n        if(area===\"local\" && changes.projects) loadProjects();\n    });\n\n    startBtn.onclick = function() {\n        let prj = projectSelect.value;\n        if (!prj) { alert(\"Выберите проект!\"); return; }\n        chrome.storage.local.set({selectedProjectId:prj}, ()=> {\n            chrome.storage.local.get(['stopwatch', 'calendarEvents', 'projects'], res=>{\n                let sw = res.stopwatch||{};\n                if (sw.isRunning) return;\n                const projectsArr = res.projects || [];\n                const project = projectsArr.find(p => p.id === prj);\n                const now = new Date();\n                const pad = x => x.toString().padStart(2, '0');\n                const localIso = dt => dt.getFullYear() + '-' + pad(dt.getMonth()+1) + '-' + pad(dt.getDate()) + 'T' + pad(dt.getHours()) + ':' + pad(dt.getMinutes());\n                const getLocalDateString = dt => `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())}`;\n                const liveEv = {\n                    id: `live-${Date.now()}`,\n                    title: project ? project.name : \"Без проекта\",\n                    description: \"\",\n                    date: getLocalDateString(now),\n                    startTime: localIso(now),\n                    endTime: localIso(new Date(now.getTime() + 60000)),\n                    projectId: prj,\n                    isLive: true,\n                    type: 'project'\n                };\n                const calendarEvents = res.calendarEvents || [];\n                calendarEvents.push(liveEv);\n                chrome.storage.local.set({\n                    stopwatch: {isRunning:true, startTimestamp: Date.now(), elapsed:0, liveEventId: liveEv.id, projectId: prj},\n                    calendarEvents\n                });\n            });\n        });\n    };\n    pauseBtn.onclick = function() {\n        chrome.storage.local.get(['stopwatch', 'calendarEvents'], res=>{\n            let sw = res.stopwatch||{};\n            if (!sw.isRunning) return;\n            let elapsed = (sw.elapsed||0) + (Date.now()-sw.startTimestamp);\n            let calendarEvents = res.calendarEvents || [];\n            if (sw.liveEventId) {\n                const evIdx = calendarEvents.findIndex(ev => ev.id === sw.liveEventId);\n                if (evIdx > -1) calendarEvents[evIdx].isLive = false;\n            }\n            chrome.storage.local.set({\n                stopwatch:{...sw,isRunning:false,startTimestamp:null,elapsed,projectId: sw.projectId||null},\n                calendarEvents\n            });\n        });\n    };\n    stopBtn.onclick = function() {\n        chrome.storage.local.get(['stopwatch', 'calendarEvents'], res=>{\n            let sw = res.stopwatch||{};\n            let calendarEvents = res.calendarEvents || [];\n            if (sw.liveEventId) {\n                const evIdx = calendarEvents.findIndex(ev => ev.id === sw.liveEventId);\n                if (evIdx > -1) calendarEvents[evIdx].isLive = false;\n            }\n            chrome.storage.local.set({\n                stopwatch:{isRunning:false,startTimestamp:null,elapsed:0,liveEventId:null,projectId:null},\n                calendarEvents\n            });\n        });\n    };\n\n    projectSelect.onchange = function() {\n        chrome.storage.local.get('stopwatch', res=>{\n            let sw = res.stopwatch||{};\n            if (sw.isRunning || sw.elapsed) {\n                chrome.storage.local.set({stopwatch:{isRunning:false,startTimestamp:null,elapsed:0,liveEventId:null,projectId: projectSelect.value}});\n            }\n            chrome.storage.local.set({selectedProjectId: projectSelect.value});\n        });\n    };\n    calendarBtn.onclick = function () {\n        chrome.tabs.create({ url: chrome.runtime.getURL(\"index.html\") });\n    };\n\n    loadProjects();\n    loadStopwatch();\n    setInterval(updateDisplay, 1000);\n});\n"],"names":["document","addEventListener","timerDisplay","getElementById","startBtn","pauseBtn","stopBtn","projectSelect","calendarBtn","projects","stopwatch","isRunning","startTimestamp","elapsed","liveEventId","projectId","interval","updateDisplay","ms","Date","now","sec","Math","floor","min","textContent","toString","padStart","style","color","disabled","value","loadProjects","chrome","storage","local","get","res","innerHTML","forEach","prj","opt","createElement","id","name","appendChild","selectedProjectId","loadStopwatch","onChanged","addListener","changes","area","onclick","alert","set","sw","projectsArr","project","find","p","pad","x","localIso","dt","getFullYear","getMonth","getDate","getHours","getMinutes","getLocalDateString","liveEv","title","description","date","startTime","endTime","getTime","isLive","type","calendarEvents","push","evIdx","findIndex","ev","onchange","tabs","create","url","runtime","getURL","setInterval"],"sourceRoot":""}