(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function n(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function o(e,n,o){return(n=function(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}document.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("timer-display"),e=document.getElementById("start-btn"),o=document.getElementById("pause-btn"),r=document.getElementById("stop-btn"),c=document.getElementById("project-select"),a=document.getElementById("calendar-btn"),i=[],l={isRunning:!1,startTimestamp:null,elapsed:0,liveEventId:null,projectId:null};function s(){var n=l.elapsed;l.isRunning&&l.startTimestamp&&(n+=Date.now()-l.startTimestamp);var a=Math.floor(n/1e3),i=Math.floor(a/60);a%=60,t.textContent="".concat(i.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0")),t.style.color="#fff",e.disabled=l.isRunning||!c.value,o.disabled=!l.isRunning,r.disabled=!l.isRunning&&0===l.elapsed}function u(){chrome.storage.local.get(["projects","selectedProjectId"],(function(t){i=t.projects||[],c.innerHTML='<option value="">-- Проект --</option>',i.forEach((function(t){var e=document.createElement("option");e.value=t.id,e.textContent=t.name,c.appendChild(e)})),t.selectedProjectId&&(c.value=t.selectedProjectId),s()}))}function d(){chrome.storage.local.get("stopwatch",(function(t){t.stopwatch&&(l=n(n({},l),t.stopwatch)),s()}))}chrome.storage.onChanged.addListener((function(t,e){"local"===e&&t.stopwatch&&d(),"local"===e&&t.projects&&u()})),e.onclick=function(){var t=c.value;t?chrome.storage.local.set({selectedProjectId:t},(function(){chrome.storage.local.get(["stopwatch","calendarEvents","projects"],(function(e){if(!(e.stopwatch||{}).isRunning){var n,o=(e.projects||[]).find((function(e){return e.id===t})),r=new Date,c=function(t){return t.toString().padStart(2,"0")},a=function(t){return t.getFullYear()+"-"+c(t.getMonth()+1)+"-"+c(t.getDate())+"T"+c(t.getHours())+":"+c(t.getMinutes())},i={id:"live-".concat(Date.now()),title:o?o.name:"Без проекта",description:"",date:(n=r,"".concat(n.getFullYear(),"-").concat(c(n.getMonth()+1),"-").concat(c(n.getDate()))),startTime:a(r),endTime:a(new Date(r.getTime()+6e4)),projectId:t,isLive:!0,type:"project"},l=e.calendarEvents||[];l.push(i),chrome.storage.local.set({stopwatch:{isRunning:!0,startTimestamp:Date.now(),elapsed:0,liveEventId:i.id,projectId:t},calendarEvents:l})}}))})):alert("Выберите проект!")},o.onclick=function(){chrome.storage.local.get(["stopwatch","calendarEvents"],(function(t){var e=t.stopwatch||{};if(e.isRunning){var o=(e.elapsed||0)+(Date.now()-e.startTimestamp),r=t.calendarEvents||[];if(e.liveEventId){var c=r.findIndex((function(t){return t.id===e.liveEventId}));c>-1&&(r[c].isLive=!1)}chrome.storage.local.set({stopwatch:n(n({},e),{},{isRunning:!1,startTimestamp:null,elapsed:o,projectId:e.projectId||null}),calendarEvents:r})}}))},r.onclick=function(){chrome.storage.local.get(["stopwatch","calendarEvents"],(function(t){var e=t.stopwatch||{},n=t.calendarEvents||[];if(e.liveEventId){var o=n.findIndex((function(t){return t.id===e.liveEventId}));o>-1&&(n[o].isLive=!1)}chrome.storage.local.set({stopwatch:{isRunning:!1,startTimestamp:null,elapsed:0,liveEventId:null,projectId:null},calendarEvents:n})}))},c.onchange=function(){chrome.storage.local.get("stopwatch",(function(t){var e=t.stopwatch||{};(e.isRunning||e.elapsed)&&chrome.storage.local.set({stopwatch:{isRunning:!1,startTimestamp:null,elapsed:0,liveEventId:null,projectId:c.value}}),chrome.storage.local.set({selectedProjectId:c.value})}))},a.onclick=function(){chrome.tabs.create({url:chrome.runtime.getURL("index.html")})},u(),d(),setInterval(s,1e3)}))})();